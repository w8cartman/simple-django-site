pipeline {

    agent none

    stages {
        stage('Build') {
	    agent {label 'Slave1'}
            steps {
		sh "pip3 install --upgrade -r mysite/requirements.txt"
                echo 'Building..'
            }
        }

        stage('Test') {
            steps {
	    agent {label 'Slave1'}
		sh "python3 mysite/manage.py test mainApp"
                echo 'Testing..'
            }
        }

        stage('Staging') {
	    agent {label 'Slave2'}
            steps {
		echo "Deploying"
		sh "python3 manage.py runserver &"
            }
        }
    }


post {
      success {
        node('master') {
           telegramSend "Job \"${JOB_NAME}\": Build №${BUILD_NUMBER} Succeed. More info: ${BUILD_URL}"
         }
      }
      failure {
        node('master') {
           telegramSend "Job \"${JOB_NAME}\": Build №${BUILD_NUMBER} Failed. More info: ${BUILD_URL}"
         }
      }
   }
}
